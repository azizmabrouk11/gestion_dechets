<div class="dashboard-container">
  <div class="dashboard-header">
    <h1>âš™ï¸ Tableau de Bord Administrateur</h1>
    <p>Gestion complÃ¨te de la collecte des dÃ©chets</p>
  </div>

  @if (isLoading) {
  <div class="loading-container">
    <div class="spinner"></div>
    <p>Chargement des donnÃ©es...</p>
  </div>
  } @if (errorMessage && !isLoading) {
  <div class="error-container">
    <p class="error-message">{{ errorMessage }}</p>
  </div>
  } @if (!isLoading && !errorMessage) {
  <div class="dashboard-content">
    <!-- Statistics Cards -->
    <div class="stats-row">
      <div class="stat-card primary">
        <div class="stat-icon">ğŸ‘¥</div>
        <div class="stat-content">
          <h3>{{ users.length }}</h3>
          <p>Total Utilisateurs</p>
          <span class="stat-detail">{{ activeUsersCount }} actifs</span>
        </div>
      </div>

      <div class="stat-card success">
        <div class="stat-icon">ğŸš›</div>
        <div class="stat-content">
          <h3>{{ vehicules.length }}</h3>
          <p>VÃ©hicules</p>
          <span class="stat-detail"
            >{{ availableVehiculesCount }} disponibles</span
          >
        </div>
      </div>

      <div class="stat-card warning">
        <div class="stat-icon">ğŸ—‘ï¸</div>
        <div class="stat-content">
          <h3>{{ containers.length }}</h3>
          <p>Conteneurs</p>
          <span class="stat-detail"
            >{{ functionalContainersCount }} fonctionnels</span
          >
        </div>
      </div>

      <div class="stat-card info">
        <div class="stat-icon">ğŸ“</div>
        <div class="stat-content">
          <h3>{{ pickUpPoints.length }}</h3>
          <p>Points de Collecte</p>
        </div>
      </div>

      <div class="stat-card danger">
        <div class="stat-icon">ğŸ›£ï¸</div>
        <div class="stat-content">
          <h3>{{ routes.length }}</h3>
          <p>Routes</p>
          <span class="stat-detail">{{ todayRoutesCount }} aujourd'hui</span>
        </div>
      </div>
    </div>

    <!-- Navigation Tabs -->
    <div class="tabs-container">
      <button
        class="tab-button"
        [class.active]="activeSection === 'overview'"
        (click)="setActiveSection('overview')"
      >
        ğŸ“Š Vue d'ensemble
      </button>
      <button
        class="tab-button"
        [class.active]="activeSection === 'users'"
        (click)="setActiveSection('users')"
      >
        ğŸ‘¥ Utilisateurs
      </button>
      <button
        class="tab-button"
        [class.active]="activeSection === 'vehicules'"
        (click)="setActiveSection('vehicules')"
      >
        ğŸš› VÃ©hicules
      </button>
      <button
        class="tab-button"
        [class.active]="activeSection === 'containers'"
        (click)="setActiveSection('containers')"
      >
        ğŸ—‘ï¸ Conteneurs
      </button>
      <button
        class="tab-button"
        [class.active]="activeSection === 'routes'"
        (click)="setActiveSection('routes')"
      >
        ğŸ›£ï¸ Routes
      </button>
      <button
        class="tab-button"
        [class.active]="activeSection === 'pickuppoints'"
        (click)="setActiveSection('pickuppoints')"
      >
        ğŸ“ Points de Collecte
      </button>
    </div>

    <!-- Overview Section -->
    @if (activeSection === 'overview') {
    <div class="section-content">
      <div class="overview-grid">
        <div class="overview-card">
          <h3>ğŸ“ˆ Statistiques RÃ©centes</h3>
          <div class="stats-list">
            <div class="stats-item">
              <span class="label">Utilisateurs actifs:</span>
              <span class="value"
                >{{ activeUsersCount }} / {{ users.length }}</span
              >
            </div>
            <div class="stats-item">
              <span class="label">VÃ©hicules opÃ©rationnels:</span>
              <span class="value"
                >{{ availableVehiculesCount }} / {{ vehicules.length }}</span
              >
            </div>
            <div class="stats-item">
              <span class="label">Conteneurs fonctionnels:</span>
              <span class="value"
                >{{ functionalContainersCount }} / {{ containers.length }}</span
              >
            </div>
            <div class="stats-item">
              <span class="label">Routes aujourd'hui:</span>
              <span class="value">{{ todayRoutesCount }}</span>
            </div>
          </div>
        </div>

        <div class="overview-card">
          <h3>âš¡ Actions Rapides</h3>
          <div class="quick-actions">
            <button class="action-btn" (click)="setActiveSection('users')">
              <span class="btn-icon">ğŸ‘¥</span>
              GÃ©rer Utilisateurs
            </button>
            <button class="action-btn" (click)="setActiveSection('vehicules')">
              <span class="btn-icon">ğŸš›</span>
              GÃ©rer VÃ©hicules
            </button>
            <button class="action-btn" (click)="setActiveSection('routes')">
              <span class="btn-icon">ğŸ›£ï¸</span>
              Planifier Routes
            </button>
            <button class="action-btn" (click)="loadAllData()">
              <span class="btn-icon">ğŸ”„</span>
              Actualiser
            </button>
          </div>
        </div>
      </div>
    </div>
    }

    <!-- Users Section -->
    @if (activeSection === 'users') {
    <div class="section-content">
      <div class="section-header">
        <h2>ğŸ‘¥ Gestion des Utilisateurs</h2>
      </div>

      @if (users.length > 0) {
      <div class="table-container">
        <table class="data-table">
          <thead>
            <tr>
              <th>Nom d'utilisateur</th>
              <th>Email</th>
              <th>Nom Complet</th>
              <th>RÃ´le</th>
              <th>Statut</th>
              <th>Auth Faciale</th>
              <th>Date CrÃ©ation</th>
            </tr>
          </thead>
          <tbody>
            @for (user of users; track user.id) {
            <tr>
              <td class="username-cell">{{ user.userName }}</td>
              <td>{{ user.email }}</td>
              <td>{{ user.firstName }} {{ user.lastName }}</td>
              <td>
                <span [class]="'role-badge ' + getRoleBadgeClass(user.role)">
                  {{ user.role }}
                </span>
              </td>
              <td>
                <span
                  [class]="
                    'status-badge ' +
                    (user.isActive ? 'status-active' : 'status-inactive')
                  "
                >
                  {{ user.isActive ? "âœ“ Actif" : "âœ— Inactif" }}
                </span>
              </td>
              <td class="text-center">
                <span
                  [class]="
                    'face-auth-badge ' +
                    (user.faceAuthEnabled ? 'enabled' : 'disabled')
                  "
                >
                  {{ user.faceAuthEnabled ? "âœ“" : "âœ—" }}
                </span>
              </td>
              <td>
                {{ user.createdAt ? (user.createdAt | date : "short") : "N/A" }}
              </td>
            </tr>
            }
          </tbody>
        </table>
      </div>
      } @else {
      <div class="empty-state">Aucun utilisateur trouvÃ©</div>
      }
    </div>
    }

    <!-- Vehicules Section -->
    @if (activeSection === 'vehicules') {
    <div class="section-content">
      <div class="section-header">
        <h2>ğŸš› Gestion des VÃ©hicules</h2>
      </div>

      @if (vehicules.length > 0) {
      <div class="cards-grid">
        @for (vehicule of vehicules; track vehicule.id) {
        <div class="entity-card">
          <div class="card-icon">ğŸš›</div>
          <div class="card-content">
            <h3>{{ vehicule.matricul }}</h3>
            <div class="card-details">
              <span class="detail-item">
                <strong>Type:</strong> {{ vehicule.type }}
              </span>
              <span class="detail-item">
                <strong>CapacitÃ©:</strong> {{ vehicule.capacity }} kg
              </span>
              <span class="detail-item">
                <strong>Statut:</strong>
                <span
                  [class]="'badge ' + getVehiculeStatusClass(vehicule.status)"
                >
                  {{ vehicule.status }}
                </span>
              </span>
            </div>
          </div>
        </div>
        }
      </div>
      } @else {
      <div class="empty-state">Aucun vÃ©hicule disponible</div>
      }
    </div>
    }

    <!-- Containers Section -->
    @if (activeSection === 'containers') {
    <div class="section-content">
      <div class="section-header">
        <h2>ğŸ—‘ï¸ Gestion des Conteneurs</h2>
      </div>

      @if (containers.length > 0) {
      <div class="cards-grid">
        @for (container of containers; track container.id) {
        <div class="entity-card">
          <div class="card-icon">ğŸ—‘ï¸</div>
          <div class="card-content">
            <h3>{{ container.type }}</h3>
            <div class="card-details">
              <span class="detail-item">
                <strong>CapacitÃ©:</strong> {{ container.capacity }} L
              </span>
              <span class="detail-item">
                <strong>Niveau:</strong> {{ container.fillLevel }}%
              </span>
              <span class="detail-item">
                <strong>Statut:</strong>
                <span
                  [class]="
                    'badge ' +
                    getContainerStatusClass(container.containerStatus)
                  "
                >
                  {{ container.containerStatus }}
                </span>
              </span>
            </div>
            <div class="progress-bar">
              <div
                class="progress-fill"
                [style.width.%]="container.fillLevel"
              ></div>
            </div>
          </div>
        </div>
        }
      </div>
      } @else {
      <div class="empty-state">Aucun conteneur disponible</div>
      }
    </div>
    }

    <!-- Routes Section -->
    @if (activeSection === 'routes') {
    <div class="section-content">
      <div class="section-header">
        <h2>ğŸ›£ï¸ Gestion des Routes</h2>
      </div>

      @if (routes.length > 0) {
      <div class="routes-list">
        @for (route of routes; track route.id) {
        <div class="route-item">
          <div class="route-header">
            <span class="route-icon">ğŸ›£ï¸</span>
            <h3>
              Route du {{ route.routeDate | date : "fullDate" : "" : "fr" }}
            </h3>
          </div>
          <div class="route-details">
            @if (route.startTime) {
            <span class="detail-badge">â° DÃ©but: {{ route.startTime }}</span>
            } @if (route.endTime) {
            <span class="detail-badge">â° Fin: {{ route.endTime }}</span>
            } @if (route.status) {
            <span class="detail-badge">ğŸ“Š {{ route.status }}</span>
            }
          </div>
        </div>
        }
      </div>
      } @else {
      <div class="empty-state">Aucune route planifiÃ©e</div>
      }
    </div>
    }

    <!-- PickUp Points Section -->
    @if (activeSection === 'pickuppoints') {
    <div class="section-content">
      <div class="section-header">
        <h2>ğŸ“ Gestion des Points de Collecte</h2>
      </div>

      @if (pickUpPoints.length > 0) {
      <div class="cards-grid">
        @for (point of pickUpPoints; track point.id) {
        <div class="entity-card">
          <div class="card-icon">ğŸ“</div>
          <div class="card-content">
            <h3>{{ point.location }}</h3>
            @if (point.address) {
            <p class="card-address">{{ point.address }}</p>
            }
            <div class="card-details">
              @if (point.latitude && point.longitude) {
              <span class="detail-item">
                <strong>CoordonnÃ©es:</strong> {{ point.latitude }},
                {{ point.longitude }}
              </span>
              }
            </div>
          </div>
        </div>
        }
      </div>
      } @else {
      <div class="empty-state">Aucun point de collecte disponible</div>
      }
    </div>
    }
  </div>
  }
</div>
