# Waste Management System (Gestion des DÃ©chets)

A comprehensive waste management application built with Spring Boot, Angular, MongoDB, and Keycloak for authentication.

## ğŸ“‹ Prerequisites

Before you begin, ensure you have the following installed:
- **Docker Desktop** - For running infrastructure services
- **JDK 17** - Required for Spring Boot backend
- **Node.js & npm** - Required for Angular frontend
- **Git** - For version control

## ğŸš€ Quick Start (Development)

### 1. Start Infrastructure Services
Start MongoDB, PostgreSQL, Keycloak, and Mongo Express:
```bash
docker compose up -d mongo mongo-express postgres keycloak
```

Wait about 30 seconds for Keycloak to fully start and import the realm configuration.

### 2. Run Backend
```bash
cd backend
mvn clean package -DskipTests
mvn spring-boot:run
```
Backend runs on: http://localhost:8082

### 3. Run Frontend
```bash
cd frontend
npm i --legacy-peer-deps
npm start
```
Frontend runs on: http://localhost:4200

### 4. Import Test Data (Optional)
Import sample data for testing:
```powershell
# Containers
docker cp test-data\containers.json projet-dechet-mongo-1:/tmp/containers.json
docker exec projet-dechet-mongo-1 mongoimport --db dechet_db --collection containers --file /tmp/containers.json --jsonArray --username root --password admin --authenticationDatabase admin

# Pickup Points
docker cp test-data\collectpoints.json projet-dechet-mongo-1:/tmp/collectpoints.json
docker exec projet-dechet-mongo-1 mongoimport --db dechet_db --collection pickuppoints --file /tmp/collectpoints.json --jsonArray --username root --password admin --authenticationDatabase admin

# Vehicles
docker cp test-data\vehicules.json projet-dechet-mongo-1:/tmp/vehicules.json
docker exec projet-dechet-mongo-1 mongoimport --db dechet_db --collection vehicules --file /tmp/vehicules.json --jsonArray --username root --password admin --authenticationDatabase admin

# Incidents
docker cp test-data\incidents.json projet-dechet-mongo-1:/tmp/incidents.json
docker exec projet-dechet-mongo-1 mongoimport --db dechet_db --collection incidents --file /tmp/incidents.json --jsonArray --username root --password admin --authenticationDatabase admin

# Notifications
docker cp test-data\notifications.json projet-dechet-mongo-1:/tmp/notifications.json
docker exec projet-dechet-mongo-1 mongoimport --db dechet_db --collection notifications --file /tmp/notifications.json --jsonArray --username root --password admin --authenticationDatabase admin

# Routes
docker cp test-data\routes.json projet-dechet-mongo-1:/tmp/routes.json
docker exec projet-dechet-mongo-1 mongoimport --db dechet_db --collection routes --file /tmp/routes.json --jsonArray --username root --password admin --authenticationDatabase admin
```

## ğŸ”— Access URLs

- **Frontend**: http://localhost:4200
- **Backend API**: http://localhost:8082/api
- **Keycloak Admin Console**: http://localhost:8080 (admin/admin)
- **Mongo Express**: http://localhost:8089 (exproot/expadmin)

## ğŸ‘¤ Default Users

- **Admin User**: 
  - Username: `admin`
  - Password: `nour123`
  
- **Normal User**: 
  - Username: `testuser`
  - Password: `test123`

## ğŸ›‘ Stop Services

```bash
# Stop all containers
docker compose down

# Stop and remove volumes (WARNING: deletes all data)
docker compose down -v
```

## ğŸ—ï¸ Production Build

### Build Frontend Docker Image
```bash
docker build \
    --build-arg ENVIRONMENT=production \
    --build-arg KEYCLOAK_URL=http://your-domain.com \
    --build-arg API_URL=http://your-domain.com/api \
    -t your-dockerhub/dechet-frontend \
    -f frontend/Dockerfile \
    frontend
```

### Build Backend Docker Image
```bash
docker build \
    -t your-dockerhub/dechet-backend \
    -f backend/Dockerfile \
    backend
```

### Run Full Stack with Docker Compose
```bash
# Set environment variables in .env file
docker compose up -d
```

## ğŸ”§ Troubleshooting

### Keycloak realm not imported
If users cannot log in, the realm might not have imported:
```bash
docker compose restart keycloak
# Wait 30 seconds, then check http://localhost:8080
```

### Frontend build errors
Clear Angular cache:
```powershell
cd frontend
Remove-Item -Recurse -Force .angular -ErrorAction SilentlyContinue
npm start
```

### Backend connection errors
Ensure infrastructure is running:
```bash
docker ps
# Should show mongo, postgres, keycloak, mongo-express running
```

## ğŸ“¦ Project Structure

```
â”œâ”€â”€ backend/               # Spring Boot application
â”œâ”€â”€ frontend/              # Angular application
â”œâ”€â”€ keycloak/
â”‚   â””â”€â”€ keycloak-import/  # Realm configuration
â”œâ”€â”€ test-data/            # Sample data for testing
â”œâ”€â”€ devops/               # Deployment configurations
â”œâ”€â”€ docker-compose.yml    # Docker services configuration
â””â”€â”€ .env                  # Environment variables
```

## ğŸ“ License

This project is licensed under the MIT License.

## ğŸ”— Repository

https://github.com/azizmabrouk11/gestion_dechets